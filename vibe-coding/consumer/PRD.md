# Product Requirements Document (PRD)
## 소비자물가지수 통계 분석 및 보도자료 생성 시스템

**문서 버전**: 1.0  
**작성일**: 2025년 1월  
**프로젝트명**: Consumer Price Index Analysis System  
**프로젝트 코드**: consumer

---

## 1. 프로젝트 개요

### 1.1 목적
지출목적별 소비자물가지수 데이터를 실시간으로 수집하고, 통계 분석을 통해 주요 인사이트를 도출하며, 전문적인 보도자료를 자동 생성하는 웹 기반 시스템을 구축한다.

### 1.2 배경
- 통계청 KOSIS(Korean Statistical Information Service)에서 제공하는 소비자물가지수 데이터를 활용
- 수동 데이터 처리 및 분석 작업의 자동화 필요
- 일관된 형식의 보도자료 생성 프로세스 표준화
- 실시간 데이터 수집 및 분석을 통한 의사결정 지원

### 1.3 목표 사용자
- 통계 분석가
- 경제 정책 연구원
- 언론 보도 담당자
- 정부 기관 공무원

---

## 2. 핵심 기능 요구사항

### 2.1 데이터 수집 기능

#### 2.1.1 KOSIS API 연동
- **요구사항**: KOSIS OpenAPI를 통해 실시간 소비자물가지수 데이터 수집
- **기능 상세**:
  - API 키 기반 인증
  - 지출목적별 소비자물가지수 데이터 조회
  - 다양한 응답 형식 처리 (리스트/딕셔너리)
  - API 오류 시 로컬 Excel 파일로 폴백
- **API 엔드포인트**: `https://kosis.kr/openapi/Param/statisticsParameterData.do`
- **데이터 테이블**: DT_1J22001 (지출목적별 소비자물가지수)

#### 2.1.2 기간 선택 기능
- **최근 N개월 선택**
  - 사용자가 개월 수 입력 (1~120개월)
  - 기본값: 36개월
  - API 파라미터: `newEstPrdCnt`
  
- **날짜 범위 선택**
  - 시작일/종료일 선택 (YYYY-MM 형식)
  - 월 단위 선택 지원
  - API 파라미터: `startPrdDe`, `endPrdDe` (YYYYMM 형식)

### 2.2 통계 분석 기능

#### 2.2.1 주요 통계량 10개 계산
시스템은 다음 10가지 통계량을 자동으로 계산한다:

1. **최근 3개월 평균 증가율**
   - 전년동월비 기준
   - 단위: %
   - 계산식: (최근 3개월 전년동월비 증가율의 평균)

2. **최고 상승률 달**
   - 전년동월비 기준 최고 상승률을 기록한 달
   - 값: 상승률 (%), 날짜: YYYY.MM

3. **최저 상승률 달**
   - 전년동월비 기준 최저 상승률을 기록한 달
   - 값: 상승률 (%), 날짜: YYYY.MM

4. **물가 상승 추세**
   - 선형 회귀 분석을 통한 월당 상승 추세
   - 단위: 월당
   - 계산식: np.polyfit을 이용한 기울기

5. **변동성 지수**
   - 표준편차를 통한 물가지수 변동성 측정
   - 계산식: 표준편차

6. **최고 변동성 지출목적**
   - 가장 변동성이 큰 지출목적 카테고리
   - 값: 변동성 (표준편차), 카테고리명

7. **최저 변동성 지출목적**
   - 가장 안정적인 지출목적 카테고리
   - 값: 변동성 (표준편차), 카테고리명

8. **물가 안정성 점수**
   - 변동성을 기반으로 한 안정성 점수
   - 범위: 0-100점 (높을수록 안정적)
   - 계산식: 100 - (표준편차 / 평균 * 100)

9. **최근 6개월 변화**
   - 최근 6개월 vs 이전 6개월 비교
   - 단위: %
   - 추세: 상승/하락/유지

10. **계절성 패턴**
    - 월별 평균 물가지수 분석
    - 최고/최저 월 식별
    - 값: 최고 월 및 값, 최저 월 및 값

#### 2.2.2 통계량 표시
- 카드 형식의 시각적 표시
- 반응형 그리드 레이아웃
- 각 통계량별 설명, 값, 단위 표시
- 추가 정보 (날짜, 카테고리, 추세 등) 표시

### 2.3 자료 다운로드 기능

#### 2.3.1 Excel 파일 다운로드
- **요구사항**: 선택한 기간의 원본 데이터를 Excel 파일로 다운로드
- **파일 형식**: .xlsx (Excel 2007+)
- **파일명 규칙**:
  - 최근 N개월: `소비자물가지수_YYYYMMDD_최근N개월.xlsx`
  - 날짜 범위: `소비자물가지수_YYYYMMDD_YYYY-MM_YYYY-MM.xlsx`
- **시트명**: "데이터"
- **데이터 구조**: 시도별, 지출목적별, 날짜별 컬럼

### 2.4 보도자료 생성 기능

#### 2.4.1 HTML 형식 보도자료
- **요구사항**: 통계 분석 결과를 바탕으로 전문적인 보도자료 자동 생성
- **구성 요소**:
  1. **헤더**
     - 제목: "소비자물가조사 보도자료"
     - 보도시점 및 배포 시간
     - 담당 부서 정보
  
  2. **일러두기**
     - 기준연도 및 가중치 기준연도 안내
     - 데이터 해석 주의사항
     - 데이터 출처 및 이용 방법
  
  3. **주요 통계량 분석**
     - 핵심 통계 지표 요약
     - 10개 통계량 상세 정보
  
  4. **지출목적별 분석**
     - 최고/최저 변동성 지출목적 분석
  
  5. **종합 분석**
     - 통계량을 종합한 분석 텍스트
     - 추세 및 인사이트 제시

#### 2.4.2 보도자료 스타일링
- 공식 문서 형식의 디자인
- 가독성 높은 색상 및 폰트
- 반응형 레이아웃
- 인쇄 최적화

---

## 3. 사용자 인터페이스 요구사항

### 3.1 메인 화면 구성

#### 3.1.1 헤더
- 제목: "지출목적별 소비자물가지수 통계 분석"
- 부제목: "주요 통계량 10개 분석 및 보도자료 생성"

#### 3.1.2 기간 선택 영역
- **레이아웃**: 수평 배치, 반응형
- **구성 요소**:
  - 기간 선택 방식 드롭다운
  - 개월 수 입력 필드 (최근 N개월 선택 시)
  - 시작일/종료일 선택 필드 (날짜 범위 선택 시)
- **상태 관리**: 선택 방식에 따라 입력 필드 표시/숨김

#### 3.1.3 액션 버튼
- **바로 실행**: 통계 분석 실행 (기본 버튼, 보라색)
- **자료 다운로드**: 원본 데이터 Excel 다운로드 (정보 버튼, 청록색)
- **보도자료 보기**: 보도자료 표시 (보조 버튼, 초록색, 비활성화 상태로 시작)

#### 3.1.4 결과 표시 영역
- **로딩 인디케이터**: 스피너 애니메이션
- **오류 메시지**: 빨간색 배경의 오류 알림
- **통계량 그리드**: 카드 형식의 통계량 표시
- **보도자료 컨테이너**: HTML 형식 보도자료 표시

### 3.2 디자인 요구사항

#### 3.2.1 색상 체계
- **주요 색상**: 보라색 그라데이션 (#667eea ~ #764ba2)
- **정보 색상**: 청록색 (#17a2b8)
- **성공 색상**: 초록색 (#28a745)
- **텍스트 색상**: 진한 회색 (#212529, #1a1a1a)
- **배경 색상**: 흰색, 연한 회색 (#f8f9fa)

#### 3.2.2 타이포그래피
- **폰트**: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif
- **제목 크기**: 2.5em (h1), 2em (h2), 1.5em (h3)
- **본문 크기**: 1em
- **가독성**: 높은 대비율, 명확한 색상 구분

#### 3.2.3 반응형 디자인
- **데스크톱**: 최대 너비 1200px, 중앙 정렬
- **태블릿**: 768px 이하에서 세로 배치
- **모바일**: 전체 너비 사용, 버튼 및 입력 필드 세로 배치

---

## 4. 기술 스택 및 아키텍처

### 4.1 백엔드

#### 4.1.1 프레임워크
- **Flask 3.0.0**: 경량 웹 프레임워크
- **Python 3.8+**: 프로그래밍 언어

#### 4.1.2 데이터 처리
- **pandas >= 2.2.0**: 데이터 분석 및 처리
- **numpy >= 1.26.0**: 수치 계산
- **openpyxl == 3.1.2**: Excel 파일 생성

#### 4.1.3 외부 연동
- **requests == 2.31.0**: HTTP 클라이언트
- **python-dotenv == 1.0.0**: 환경 변수 관리

### 4.2 프론트엔드

#### 4.2.1 기술
- **HTML5**: 마크업
- **CSS3**: 스타일링 (반응형 디자인)
- **JavaScript (ES6+)**: 클라이언트 사이드 로직
- **Fetch API**: 비동기 HTTP 요청

### 4.3 데이터 소스
- **KOSIS OpenAPI**: 통계청 공식 API
- **로컬 Excel 파일**: API 실패 시 폴백 데이터 소스

---

## 5. API 명세

### 5.1 엔드포인트 목록

#### 5.1.1 GET `/`
- **설명**: 메인 페이지 렌더링
- **응답**: HTML 템플릿

#### 5.1.2 GET `/api/statistics`
- **설명**: 통계량 계산 및 반환
- **쿼리 파라미터**:
  - `periodType` (선택): 'months' 또는 'range' (기본값: 'months')
  - `monthCount` (선택): 최근 N개월 (periodType='months'일 때)
  - `startDate` (선택): YYYY-MM 형식 시작일 (periodType='range'일 때)
  - `endDate` (선택): YYYY-MM 형식 종료일 (periodType='range'일 때)
- **응답 형식**: JSON
  ```json
  {
    "success": true,
    "statistics": {
      "최근_3개월_평균_증가율": {
        "value": 2.1,
        "unit": "%",
        "description": "최근 3개월 평균 증가율 (전년동월비)"
      },
      ...
    }
  }
  ```
- **에러 응답**:
  ```json
  {
    "success": false,
    "error": "에러 메시지"
  }
  ```

#### 5.1.3 GET `/api/press-release`
- **설명**: 보도자료 HTML 생성 및 반환
- **쿼리 파라미터**: `/api/statistics`와 동일
- **응답 형식**: JSON
  ```json
  {
    "success": true,
    "html": "<div class=\"press-release\">...</div>"
  }
  ```

#### 5.1.4 GET `/api/download-data`
- **설명**: 원본 데이터 Excel 파일 다운로드
- **쿼리 파라미터**: `/api/statistics`와 동일
- **응답 형식**: Excel 파일 (.xlsx)
- **Content-Type**: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
- **Content-Disposition**: `attachment; filename="소비자물가지수_YYYYMMDD_*.xlsx"`

### 5.2 KOSIS API 연동

#### 5.2.1 API 엔드포인트
- **URL**: `https://kosis.kr/openapi/Param/statisticsParameterData.do`
- **Method**: GET
- **인증**: API Key (쿼리 파라미터)

#### 5.2.2 필수 파라미터
- `method`: 'getList'
- `apiKey`: KOSIS API 키 (환경 변수에서 로드)
- `itmId`: 'T+'
- `objL1`: 'T10+'
- `objL2`: '0+A+B+C+D+E+F+G+H+I+J+K+L+'
- `format`: 'json'
- `jsonVD`: 'Y'
- `prdSe`: 'M' (월 단위)
- `orgId`: '101' (통계청)
- `tblId`: 'DT_1J22001' (지출목적별 소비자물가지수)

#### 5.2.3 기간 파라미터
- **최근 N개월**: `newEstPrdCnt` (문자열 형식 숫자)
- **날짜 범위**: `startPrdDe`, `endPrdDe` (YYYYMM 형식)

---

## 6. 데이터 모델

### 6.1 입력 데이터 구조

#### 6.1.1 KOSIS API 응답
```json
[
  {
    "C1_NM": "전국",
    "C2_NM": "0 총지수",
    "PRD_DE": "202010",
    "DT": "100.00"
  },
  ...
]
```

#### 6.1.2 변환된 DataFrame
- **컬럼 구조**:
  - `시도별`: 지역 정보 (예: "전국")
  - `지출목적별`: 지출 목적 카테고리 (예: "0 총지수")
  - `YYYY.MM`: 날짜별 물가지수 값 (예: "2020.10": 100.00)

### 6.2 통계량 데이터 구조

#### 6.2.1 통계량 객체
```python
{
  "value": float,           # 통계값
  "unit": str,              # 단위 (선택)
  "description": str,       # 설명
  "date": str,              # 날짜 (선택)
  "category": str,          # 카테고리 (선택)
  "trend": str,             # 추세 (선택)
  "highest_month": str,     # 최고 월 (선택)
  "highest_value": float,   # 최고 값 (선택)
  "lowest_month": str,      # 최저 월 (선택)
  "lowest_value": float     # 최저 값 (선택)
}
```

---

## 7. 비기능 요구사항

### 7.1 성능 요구사항
- **API 응답 시간**: 3초 이내
- **통계 계산 시간**: 5초 이내
- **파일 다운로드**: 10초 이내 (최대 36개월 데이터 기준)
- **동시 사용자**: 최대 10명

### 7.2 보안 요구사항
- **API 키 관리**: 환경 변수(.env)를 통한 관리, Git 저장소에 커밋 금지
- **입력 검증**: 기간 파라미터 유효성 검사
- **에러 처리**: 민감한 정보 노출 방지

### 7.3 사용성 요구사항
- **직관적인 UI**: 명확한 버튼 레이블 및 안내 문구
- **로딩 상태 표시**: 진행 중인 작업에 대한 시각적 피드백
- **에러 메시지**: 사용자 친화적인 오류 안내
- **반응형 디자인**: 다양한 디바이스에서 사용 가능

### 7.4 호환성 요구사항
- **브라우저**: Chrome, Firefox, Safari, Edge (최신 2개 버전)
- **Python 버전**: 3.8 이상
- **운영체제**: Windows, macOS, Linux

---

## 8. 에러 처리

### 8.1 에러 시나리오

#### 8.1.1 API 연동 오류
- **시나리오**: KOSIS API 호출 실패
- **처리**: 로컬 Excel 파일로 폴백
- **사용자 알림**: "API 호출 실패: 로컬 파일을 사용합니다."

#### 8.1.2 데이터 변환 오류
- **시나리오**: API 응답 형식이 예상과 다름
- **처리**: 로컬 Excel 파일로 폴백
- **사용자 알림**: "데이터 변환 실패: 로컬 파일을 사용합니다."

#### 8.1.3 통계 계산 오류
- **시나리오**: 데이터 부족 또는 형식 오류
- **처리**: 에러 메시지 반환
- **사용자 알림**: "통계 분석 중 오류가 발생했습니다: [상세 메시지]"

#### 8.1.4 API 키 미설정
- **시나리오**: .env 파일에 KOSIS_API_KEY가 없음
- **처리**: ValueError 발생
- **사용자 알림**: "KOSIS_API_KEY가 설정되지 않았습니다."

---

## 9. 배포 및 운영

### 9.1 환경 설정

#### 9.1.1 필수 환경 변수
- `KOSIS_API_KEY`: KOSIS OpenAPI 키

#### 9.1.2 설치 절차
1. Python 3.8+ 설치
2. 가상환경 생성 및 활성화
3. 의존성 설치: `pip install -r requirements.txt`
4. `.env` 파일 생성 및 API 키 설정
5. 애플리케이션 실행: `python app.py`

### 9.2 배포 요구사항
- **포트**: 8889 (기본값, 변경 가능)
- **디버그 모드**: 개발 환경에서만 활성화
- **정적 파일**: Flask static 폴더 사용

### 9.3 운영 고려사항
- **로깅**: 에러 로그 기록
- **모니터링**: API 응답 시간 및 오류율 모니터링
- **백업**: 로컬 Excel 파일 백업

---

## 10. 향후 개선 사항

### 10.1 기능 개선
- [ ] 차트/그래프 시각화 추가
- [ ] 여러 기간 비교 분석
- [ ] PDF 형식 보도자료 다운로드
- [ ] 이메일 자동 발송 기능
- [ ] 사용자 인증 및 세션 관리

### 10.2 성능 개선
- [ ] 데이터 캐싱
- [ ] 비동기 처리
- [ ] 데이터베이스 연동

### 10.3 사용성 개선
- [ ] 다국어 지원
- [ ] 접근성 향상 (WCAG 준수)
- [ ] 키보드 단축키 지원

---

## 11. 승인 및 검토

### 11.1 문서 승인
- **작성자**: 개발팀
- **검토자**: [검토자명]
- **승인자**: [승인자명]
- **최종 승인일**: [날짜]

### 11.2 변경 이력
| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-01 | 초기 문서 작성 | 개발팀 |

---

## 부록

### A. 용어 정의
- **KOSIS**: Korean Statistical Information Service (한국통계정보서비스)
- **전년동월비**: 전년 동월 대비 증가율
- **총지수**: 모든 지출목적을 포함한 전체 물가지수

### B. 참고 자료
- [KOSIS OpenAPI 문서](https://kosis.kr/openapi/openApiList.do)
- [통계청 소비자물가지수 공표](https://kostat.go.kr/portal/korea/kor_nw/1/1/index.board?bmode=read&aSeq=...)

### C. 연락처
- **프로젝트 리더**: [이름]
- **기술 문의**: [이메일]
- **버그 리포트**: [이슈 트래커 URL]

---

**문서 끝**

